# Architecture Decision Records (ADR)

Este diretorio contem as decisoes arquiteturais do sistema.

Cada ADR registra:

- O contexto do problema
- A decisao tomada
- As alternativas consideradas
- As consequencias

O objetivo e manter rastreabilidade e clareza sobre **por que o sistema e assim**.

---

## üìò Lista de ADRs

### ADR-001

- **Titulo:** Separacao entre Fato Gerador, Fluxo de Caixa e DRE
- **Status:** Aceito
- **Link:** [ADR-001](ADR-001-separacao-fato-gerador-caixa-dre.md)

### ADR-002

- **Titulo:** Autenticacao Supabase (Auth + JWT)
- **Status:** Aceito
- **Link:** [ADR-002](ADR-002-autenticacao-supabase.md)

### ADR-003

- **Titulo:** RLS e Modelo de Permissoes
- **Status:** Aceito
- **Link:** [ADR-003](ADR-003-rls-e-modelo-permissoes.md)

### ADR-004

- **Titulo:** Relacionamentos Bidirecionais em Familias
- **Status:** Aceito
- **Link:** [ADR-004](ADR-004-relacionamentos-bidirecionais-familias.md)

### ADR-012

- **Titulo:** M√≥dulo Intercess√£o V2, CRM de Evangelismo e Chatbot Multimodal IA
- **Status:** Aceito
- **Link:** [ADR-012](012-intercessao-v2-evangelismo.md)

### ADR-014

- **Titulo:** M√≥dulo Gabinete Digital, Roteamento Pastoral e Unifica√ß√£o de Entradas
- **Status:** Aceito
- **Link:** [ADR-014](ADR-014-gabinete-digital-e-roteamento-pastoral.md)

### ADR-017

- **Titulo:** Refatora√ß√£o para Hub de Eventos e Hub de Voluntariado
- **Status:** Aceito (Em Implementa√ß√£o)
- **Link:** [ADR-017](ADR-017-refatoracao-hub-eventos-voluntariado.md)
- **Resumo:** Generaliza√ß√£o da entidade `cultos` para `eventos` com polimorfismo via tipos discriminados, permitindo gerenciar cultos, rel√≥gios de ora√ß√£o, tarefas operacionais e eventos gerais em uma √∫nica estrutura.

### ADR-018

- **Titulo:** Estrat√©gia de Migra√ß√£o Cultos ‚Üí Eventos
- **Status:** Implementado
- **Link:** [ADR-018](ADR-018-estrategia-migracao-cultos-eventos.md)
- **Resumo:** Documenta√ß√£o detalhada da migra√ß√£o em 5 fases (Schema ‚Üí FKs ‚Üí Frontend ‚Üí Edge Functions ‚Üí Features) com pontos de valida√ß√£o e rollback.

### ADR-020

- **Titulo:** Portal de Voluntariado com Triagem Inteligente
- **Status:** Implementado
- **Link:** [ADR-020](ADR-020-portal-voluntariado-triagem-inteligente.md)
- **Resumo:** Sistema de inscri√ß√£o p√∫blica de volunt√°rios com valida√ß√£o autom√°tica de elegibilidade por minist√©rio e integra√ß√£o com trilhas de forma√ß√£o.

### ADR-021

- **Titulo:** Arquitetura Multi-tenant com Isolamento por Igreja
- **Status:** Implementado
- **Link:** [ADR-021](ADR-021-multi-tenant-arquitetura.md)
- **Resumo:** Implementa√ß√£o de isolamento completo por igreja com coluna `igreja_id` em 30+ tabelas, RLS policies, super admin dashboard e suporte a filiais hier√°rquicas.

### ADR-022

- **Titulo:** Estrategia de Importacao de Extratos via API (Santander e Getnet)
- **Status:** Proposto
- **Link:** [ADR-022](ADR-022-importacao-extratos-api.md)
- **Resumo:** Conectores por provedor usando polling inicial com backoff, dedupe/idempotencia antes de persistir em `extratos_bancarios`, armazenamento seguro de credenciais e observabilidade basica.

### ADR-023

- **Titulo:** Confer√™ncia Cega com Contagem Dupla e Toler√¢ncia Parametrizada
- **Status:** Aceito
- **Link:** [ADR-023](ADR-023-conferencia-cega-contagem-dupla.md)
- **Resumo:** Modelo de contagem dupla independente com snapshot imut√°vel, toler√¢ncia configur√°vel (% e R$), blind count (opcional/obrigat√≥rio), e base para sincroniza√ß√£o com provedores externos via `finance-sync`.

### ADR-024

- **Titulo:** Webhook PIX Santander com CORS aberto e health check
- **Status:** Aceito
- **Link:** [ADR-024](ADR-024-pix-webhook-santander.md)
- **Resumo:** Endpoint GET/POST exigido pelo Santander, CORS aberto somente para o webhook, resolu√ß√£o de `igreja_id` via CNPJ da chave PIX e persist√™ncia idempotente em `pix_webhook_temp` com payload bruto.

---

## üìê Relacao com Diagramas

Os ADRs referenciam diagramas localizados em `../diagramas/` e documentos de arquitetura em `../01-Arquitetura/`.
