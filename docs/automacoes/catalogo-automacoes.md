# üìã Cat√°logo de Automa√ß√µes

Este documento lista todas as automa√ß√µes existentes no sistema.
Nenhuma automa√ß√£o deve ser criada sem atualiza√ß√£o deste cat√°logo.

| Automa√ß√£o | Tipo | Onde Vive (Path Real) | Disparo | M√≥dulo Afetado | O que Faz | Impacto | Refer√™ncias |
|----------|------|----------------------|---------|---------------|-----------|---------|-------------|
| Edge Function ¬∑ biometric-login | Edge Function | supabase/functions/biometric-login/index.ts | HTTP POST /functions/v1/biometric-login | Auth | Verifica credentialId recebido com profiles.biometric_credential_id e responde sucesso ou erro. | Sustenta login biom√©trico sem expor chaves privilegiadas no client. | n/a |
| Edge Function ¬∑ cadastro-publico | Edge Function | supabase/functions/cadastro-publico/index.ts | HTTP POST /functions/v1/cadastro-publico | Pessoas | Processa a√ß√µes de cadastro de visitante, busca e atualiza√ß√£o de membro com rate-limit e notify_admins. | Automatiza capta√ß√£o externa e promove visitantes recorrentes sem interven√ß√£o manual. | n/a |
| Edge Function ¬∑ checkin-evento | Edge Function | supabase/functions/checkin-evento/index.ts | HTTP POST /functions/v1/checkin-evento | Cultos & Ensino | Aplica rate-limit, encontra pessoa por email/telefone e grava presen√ßa em presencas_culto ou presencas_aula. | Garante registro imediato de presen√ßas por QR Code evitando duplicidades. | n/a |
| Edge Function ¬∑ checkin-whatsapp-geo | Edge Function | supabase/functions/checkin-whatsapp-geo/index.ts | Webhook Make com x-webhook-secret v√°lido | Cultos | Valida segredo, limita requisi√ß√µes e delega checkin_por_localizacao para registrar presen√ßa por geolocaliza√ß√£o. | Permite check-in via WhatsApp/Make controlando fraude por dist√¢ncia. | supabase/migrations/20251203014529_33465599-90b0-469a-aad4-478cb8b45d9b.sql |
| Edge Function ¬∑ chatbot-triagem | Edge Function | supabase/functions/chatbot-triagem/index.ts | HTTP POST /functions/v1/chatbot-triagem (verify_jwt=false) | Intercess√£o & Evangelismo | Triagem via WhatsApp: mant√©m sess√£o em `atendimentos_bot`, transcreve √°udio (Whisper), chama `gpt-4o-mini`, registra audit log e cria pedidos/testemunhos/solicita√ß√µes pastorais vinculando membro ou lead. | Automatiza acolhimento pastoral 24/7 sem expor credenciais sens√≠veis. | docs/adr/ADR-013: M√≥dulo Intercess√£o V2, CRM de Evangelismo e Chatbot Multimodal |
| Edge Function ¬∑ disparar-alerta | Edge Function | supabase/functions/disparar-alerta/index.ts | HTTP POST /functions/v1/disparar-alerta | Notifica√ß√µes | Resolve notificacao_regras, formata mensagens e envia in-app, WhatsApp (Make ou Meta) e push placeholder. | Centraliza disparo multi-canal de alertas configur√°veis. | docs/adr/ADR-007-estrategia-entrega-notificacoes.md<br>docs/diagramas/sequencia-notificacoes.md |
| Edge Function ¬∑ notificar-aniversarios | Edge Function | supabase/functions/notificar-aniversarios/index.ts | pg_cron via edge_function_config (cron 0 11 * * *, a confirmar) | Pessoas | Busca anivers√°rios do dia seguinte, envia notify_admins e registra log_edge_function_execution. | Mant√©m lideran√ßa informada com anteced√™ncia sobre datas importantes. | supabase/migrations/20251129185658_24ffb3f2-2e02-4d48-941a-5c13c9068b1f.sql |
| Edge Function ¬∑ notificar-liturgia-make | Edge Function | supabase/functions/notificar-liturgia-make/index.ts | HTTP POST /functions/v1/notificar-liturgia-make | Cultos | Consolida liturgia do culto e publica JSON no webhook configurado no Make. | Sincroniza planejamento de liturgia com automa√ß√µes externas. | supabase/migrations/20251130053509_fdcb9999-e713-42fb-822c-0e80423f1d9b.sql |
| Edge Function ¬∑ notificar-sentimentos-diario | Edge Function | supabase/functions/notificar-sentimentos-diario/index.ts | pg_cron via edge_function_config (cron 0 12 * * *, a confirmar) | Sentimentos | Lista membros ativos, gera notifica√ß√µes sentimento_diario e registra execu√ß√£o. | Estimula check-ins emocionais di√°rios sem a√ß√£o manual da equipe. | supabase/migrations/20251129185658_24ffb3f2-2e02-4d48-941a-5c13c9068b1f.sql |
| Edge Function ¬∑ processar-nota-fiscal | Edge Function | supabase/functions/processar-nota-fiscal/index.ts | HTTP POST autenticado /functions/v1/processar-nota-fiscal | Finan√ßas | Valida sess√£o e cargos, envia imagem ao Lovable Gemini e retorna dados estruturados da nota. | Acelera confer√™ncia de comprovantes financeiros com OCR assistido. | n/a |
| Edge Function ¬∑ receber-pedido-make | Edge Function | supabase/functions/receber-pedido-make/index.ts | Webhook Make com x-webhook-secret v√°lido | Intercess√£o | Valida payload via zod, tenta vincular pessoa (buscar_pessoa_por_contato) e insere pedido de ora√ß√£o. | Conecta formul√°rios externos ao pipeline pastoral com consist√™ncia de dados. | supabase/migrations/20251217042013_54ab2017-7153-496e-9edd-5cf8c437b180.sql |
| Edge Function ¬∑ receber-testemunho-make | Edge Function | supabase/functions/receber-testemunho-make/index.ts | Webhook Make com x-webhook-secret v√°lido | Testemunhos | Valida webhook, gera t√≠tulo autom√°tico e salva testemunho vinculando autor quando poss√≠vel. | Automatiza entrada de testemunhos oriundos de automa√ß√µes externas. | n/a |
| Edge Function ¬∑ verificar-escalas-pendentes | Edge Function | supabase/functions/verificar-escalas-pendentes/index.ts | pg_cron (cron.schedule 'lembrete-diario-escalas', a confirmar) | Escalas | Procura escalas pendentes a 24-48h do culto e chama disparar-alerta para cada volunt√°rio. | Reduz faltas lembrando volunt√°rios dos compromissos com anteced√™ncia. | docs/diagramas/sequencia-notificacoes.md |
| Edge Function ¬∑ verificar-sentimentos-criticos | Edge Function | supabase/functions/verificar-sentimentos-criticos/index.ts | pg_cron via edge_function_config (cron 0 11 * * *, a confirmar) | Sentimentos | Analisa 7 dias de sentimentos, identifica casos cr√≠ticos e notifica admins al√©m de acionar webhook Make. | D√° visibilidade r√°pida sobre membros com padr√£o emocional preocupante. | supabase/migrations/20251129185658_24ffb3f2-2e02-4d48-941a-5c13c9068b1f.sql |
| Trigger ¬∑ trigger_notify_new_visitor | Trigger (Postgres) | supabase/migrations/20251127201908_064e205a-4152-47c8-9488-402f12d3278a.sql | AFTER INSERT ON public.profiles | Pessoas | Quando perfil √© criado com status visitante, executa notify_admins com resumo do cadastro. | Alerta administra√ß√£o sobre novos visitantes assim que entram no sistema. | docs/database-schema.sql |
| Trigger ¬∑ trigger_notify_status_promotion | Trigger (Postgres) | supabase/migrations/20251127201908_064e205a-4152-47c8-9488-402f12d3278a.sql | AFTER UPDATE ON public.profiles | Pessoas | Detecta mudan√ßa de status e envia notify_admins com detalhes da promo√ß√£o. | Mant√©m lideran√ßa informada sobre evolu√ß√µes de status dos membros. | docs/database-schema.sql |
| Trigger ¬∑ trigger_notify_role_assignment | Trigger (Postgres) | supabase/migrations/20251127201908_064e205a-4152-47c8-9488-402f12d3278a.sql | AFTER INSERT ON public.user_roles | Admin | Ao atribuir cargo, busca nome do usu√°rio e notifica admins sobre a nova fun√ß√£o. | Cria trilha audit√°vel para concess√£o de pap√©is sens√≠veis. | docs/database-schema.sql |
| Trigger ¬∑ trigger_notify_role_removal | Trigger (Postgres) | supabase/migrations/20251127201908_064e205a-4152-47c8-9488-402f12d3278a.sql | AFTER DELETE ON public.user_roles | Admin | Notifica admins quando um cargo √© removido incluindo metadados da a√ß√£o. | Garante visibilidade sobre revoga√ß√£o de acessos administrativos. | docs/database-schema.sql |
| Trigger ¬∑ trigger_notify_new_pedido_oracao | Trigger (Postgres) | supabase/migrations/20251129182548_fbd6269d-e39f-4e1c-872c-8debc4ed61af.sql | AFTER INSERT ON public.pedidos_oracao | Intercess√£o | Formata exibi√ß√£o an√¥nima ou identificada e dispara notify_admins com dados do pedido. | Faz a equipe pastoral ser avisada assim que um pedido chega. | docs/database-schema.sql |
| Trigger ¬∑ trigger_notify_new_testemunho | Trigger (Postgres) | supabase/migrations/20251128213908_ad96cd4b-d1fb-45db-8260-64d378ee43a5.sql | AFTER INSERT ON public.testemunhos | Testemunhos | Consulta autor, trata anonimiza√ß√£o e cria notifica√ß√£o do novo testemunho. | Publica√ß√£o de testemunhos gera alerta imediato para curadoria. | docs/database-schema.sql |
| Trigger ¬∑ trigger_notify_kids_diario | Trigger (Postgres) | supabase/migrations/20251209_kids_notifications.sql | AFTER INSERT ON public.kids_diario | Kids | Identifica respons√°vel (familias ou responsavel_id) e insere notifica√ß√£o kids_diario para o app. | Respons√°veis recebem push assim que o di√°rio da crian√ßa √© publicado. | docs/NOTIFICACOES_KIDS.md |
| Trigger ¬∑ trigger_notify_kids_checkout | Trigger (Postgres) | supabase/migrations/20251209_kids_notifications.sql | AFTER UPDATE ON public.kids_checkins | Kids | Quando checkout_at deixa de ser nulo, dispara notifica√ß√£o kids_checkout ao respons√°vel. | Confirma sa√≠da das crian√ßas para os respons√°veis em tempo real. | docs/NOTIFICACOES_KIDS.md |
| Trigger ¬∑ kids_checkin_registra_presenca | Trigger (Postgres) | supabase/migrations/20251209_kids_presence_on_checkin.sql | AFTER INSERT ON public.kids_checkins | Kids & Cultos | Ao registrar check-in, grava presen√ßa da crian√ßa e do respons√°vel em presencas_culto. | Atualiza dashboards de presen√ßa imediatamente na entrada do Kids. | docs/SPRINT_KIDS_SUMMARY.md |
| Trigger ¬∑ trigger_sync_intercessor_insert | Trigger (Postgres) | supabase/migrations/20251217235317_75837073-ac59-4ed9-9c6b-8f84c9bedf00.sql | AFTER INSERT ON public.membros_time | Intercess√£o | Quando membro entra em time com nome Intercess√£o/Ora√ß√£o/Clamor, cria ou reativa registro na tabela intercessores. | Mant√©m base de intercessores alinhada com composi√ß√£o dos times ministeriais. | docs/adr/ADR-011-evolucao-ministerio-intercessao.md |
| Trigger ¬∑ trigger_sync_intercessor_delete | Trigger (Postgres) | supabase/migrations/20251217235317_75837073-ac59-4ed9-9c6b-8f84c9bedf00.sql | AFTER DELETE ON public.membros_time | Intercess√£o | Desativa intercessor correspondente quando o membro sai do time de intercess√£o. | Evita escalar pedidos para quem n√£o est√° mais ativo no minist√©rio. | docs/adr/ADR-011-evolucao-ministerio-intercessao.md |
| Trigger ¬∑ trigger_atualizar_saldo_conta | Trigger (Postgres) | supabase/migrations/20251130045754_7c619efc-d67a-4da9-a6bf-1e7ab51cab83.sql | AFTER UPDATE ON public.transacoes_financeiras | Finan√ßas | Ajusta contas.saldo_atual conforme transa√ß√£o muda para pago ou deixa de estar paga (entrada/sa√≠da). | Mant√©m saldo das contas refletindo liquida√ß√µes sem necessidade de jobs externos. | docs/database-schema.sql |
